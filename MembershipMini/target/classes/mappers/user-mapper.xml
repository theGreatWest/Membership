<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >


<mapper namespace="com.mini.membership.mapper.UserMapper">
    <!-- USER_TBL -->
    <resultMap type="com.mini.membership.dto.User" id="userResultMap">
	    <id property="userId" column="USER_ID"/>
	    <result property="name" column="NAME"/>
	    <result property="photo" column="PHOTO"/>
	    <result property="email" column="EMAIL"/>
	    <result property="password" column="PASSWORD"/>
	</resultMap>
    
    <!-- CAR_TBL -->
    <resultMap type="com.mini.membership.dto.Car" id="carResultMap">
	    <id property="carId" column="CAR_ID"/>
	    <result property="userId" column="USER_ID"/>
	    <result property="model" column="MODEL"/>
	    <result property="carNumber" column="CAR_NUMBER"/>
	    <result property="carName" column="CAR_NAME"/>
	    <result property="releaseDate" column="RELEASE_DATE"/>
	</resultMap>
    
    <!-- CARD_TBL -->
    <resultMap type="com.mini.membership.dto.Card" id="cardResultMap">
	    <id property="cardId" column="CARD_ID"/>
	    <result property="userId" column="USER_ID"/>
	    <result property="cardType" column="CARD_TYPE"/>
	    <result property="cardName" column="CARD_NAME"/>
	    <result property="cardNumber" column="CARD_NUMBER"/>
	    <result property="applicationDate" column="APPLICATION_DATE"/>
	    <result property="status" column="STATUS"/>
	</resultMap>
	
	<!-- POINT_TBL -->
	<resultMap type="com.mini.membership.dto.Point" id="pointResultMap">
	    <id property="pointId" column="point_id" />
	    <result property="userId" column="user_id" />
	    <result property="type" column="type" />
	    <result property="amount" column="amount" />
	    <result property="processedAt" column="processed_at" />
	</resultMap>
    
    <!-- SQL 코드 -->
    <!-- 회원 정보 -->
    <!-- 이메일/비밀번호를 이용해 특정 회원 정보 반환 -->
   	<select id="selectTargetUser" parameterType="String" resultMap="userResultMap">
   		SELECT * FROM USER_TBL WHERE email = #{email}
   	</select>
    
    <!-- 회원가입 -->
    <insert id="signUp" parameterType="com.mini.membership.dto.Signup">
	    INSERT INTO USER_TBL (name, email, password)
	    VALUES (#{name}, #{email}, #{password})
	</insert>
    
    <!-- 회원 정보 업데이트 -->
	<update id="updateUser" parameterType="com.mini.membership.dto.User">
	    UPDATE USER_TBL
	    SET name = #{name},
	        photo = #{photo},
	        email = #{email},
	        password = #{password}
	    WHERE user_id = #{userId}
	</update>
	
	<delete id="removeAccount" parameterType="int">
	    DELETE FROM USER_TBL
	    WHERE user_id = #{userId}
	</delete>
	
	<!-- 차 정보 -->
	<!-- 특정 회원이 가지고 있는 모든 차 반환 -->
   	<select id="getCars" parameterType="int" resultMap="carResultMap">
	    select * from CAR_TBL where user_id = #{userId}
	</select>
	
	<!-- 카드 정보 -->
	<!-- 특정 회원이 가지고 있는 모든 카드 반환 -->
	<select id="getCards" parameterType="int" resultMap="cardResultMap">
	    SELECT * FROM CARD_TBL 
	    WHERE user_id = #{userId}
	    ORDER BY application_date DESC
	</select>
	
	
	<!-- 포인트 정보 -->
	<!-- 특정 회원이 가지고 있는 모든 포인트 조회 -->
   	<select id="getPoints" parameterType="int" resultMap="pointResultMap">
	    SELECT * FROM POINT_TBL 
	    WHERE user_id = #{userId}
	</select>

	
</mapper>